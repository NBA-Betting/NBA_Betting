<!doctype html>
<html lang="en">

<head>
    <title>NBA Betting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- <meta http-equiv="refresh" content="30"> -->
</head>

<body>

    <!--HEADER and NAVBAR-->
    <div class="container">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                <img class="bi me-2" src="/static/img/basketball_hoop.png" alt="Basketball Hoop Logo Icon" width="60"
                    height="60">
                <span class="fs-1">NBA Betting</span>
            </a>

            <ul class="nav nav-pills d-lg-flex align-items-center">
                <li class="nav-item"><a href="/" class="nav-link active" aria-current="page">Home</a></li>
                <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
            </ul>
        </header>
    </div>

    <!--BANKROLL and PERFORMANCE-->

    <div class="container" style="height: 35vh;">
        <div class="row">
            <div class="col-5">
                <div class="row">
                    <h2 class="col text-center">Current Balance:
                        {% if current_balance_rounded > 0 %}
                        <span class="text-success">${{current_balance_rounded}}</span>
                        {% else %}
                        <span class="text-danger">${{current_balance_rounded}}</span>
                        {% endif %}
                    </h2>
                </div>
                <div class="row">
                    <h2 class="col text-center">Yesterday's Win/Loss:
                        {% if yest_win_loss >= 0 %}
                        <span class="text-success">${{yest_win_loss}}</span>
                        {% else %}
                        <span class="text-danger">${{yest_win_loss}}</span>
                        {% endif %}
                    </h2>
                </div>
                <div class="row">
                    <h2 class="col text-center"><br>Performance:
                    </h2>
                </div>
                <div class="row">
                    <div class="col">
                        <h4 class="text-center">Alltime</h4>
                        {% if isinstance(alltime_diff, str) %}
                        <h4 class="text-center">{{alltime_diff}}<br>{{alltime_pct_diff}}</h4>
                        {% elif alltime_diff >= 0 %}
                        <h4 class="text-success text-center">${{alltime_diff}}<br>({{alltime_pct_diff}}%)</h4>
                        {% else %}
                        <h4 class="text-danger text-center">${{alltime_diff}}<br>({{alltime_pct_diff}}%)</h4>
                        {% endif %}
                    </div>
                    <div class="col">
                        <h4 class="text-center">Year</h4>
                        {% if isinstance(year_diff, str) %}
                        <h4 class="text-center">{{year_diff}}<br>{{year_pct_diff}}</h4>
                        {% elif year_diff >= 0 %}
                        <h4 class="text-success text-center">${{year_diff}}<br>({{year_pct_diff}}%)</h4>
                        {% else %}
                        <h4 class="text-danger text-center">${{year_diff}}<br>({{year_pct_diff}}%)</h4>
                        {% endif %}
                    </div>
                    <div class="col">
                        <h4 class="text-center">Month</h4>
                        {% if isinstance(month_diff, str) %}
                        <h4 class="text-center">{{month_diff}}<br>{{month_pct_diff}}</h4>
                        {% elif month_diff >= 0 %}
                        <h4 class="text-success text-center">${{month_diff}}<br>({{month_pct_diff}}%)</h4>
                        {% else %}
                        <h4 class="text-danger text-center">${{month_diff}}<br>({{month_pct_diff}}%)</h4>
                        {% endif %}
                    </div>
                    <div class="col">
                        <h4 class="text-center">Week</h4>
                        {% if isinstance(week_diff, str) %}
                        <h4 class="text-center">{{week_diff}}<br>{{week_pct_diff}}</h4>
                        {% elif week_diff >= 0 %}
                        <h4 class="text-success text-center">${{week_diff}}<br>({{week_pct_diff}}%)</h4>
                        {% else %}
                        <h4 class="text-danger text-center">${{week_diff}}<br>({{week_pct_diff}}%)</h4>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!--GRAPH-->

            <div class="col-7">
                <h2 class="text-center">Account Balance</h2>
                <img src='home_page_plot.png' alt="Betting Account Profit Loss" class='img-fluid' />
            </div>
        </div>
    </div>

    <!--TABLE of GAMES-->

    <div class="container">
        <p class="text-muted small mb-2">Spread: negative = home favored. Pick: which team covers the spread.</p>
        <table class="table table-striped">
            <thead class="table-light">
                <tr>
                    <th scope="col" class="text-center">Date/Time</th>
                    <th scope="col" class="text-center">Home</th>
                    <th scope="col" class="text-center">Away</th>
                    <th scope="col" class="text-center">Spread</th>
                    <th scope="col" class="text-center">Pick</th>
                    <th scope="col" class="text-center">Confidence</th>
                    <th scope="col" class="text-center">Result</th>
                    <th scope="col" class="text-center">Bet</th>
                    <th scope="col" class="text-center"></th>
                </tr>
            </thead>
            <tbody>
                {% for rec in records %}
                <tr>
                    <td class="text-center">{{rec['game_datetime']}}</td>
                    <td class="text-center">{{rec['home_team']}}</td>
                    <td class="text-center">{{rec['away_team']}}</td>
                    <td class="text-center">{{rec['spread']}}</td>
                    <td class="text-center">{{rec['pick']}}</td>
                    <td class="text-center">{{rec['confidence']}}</td>
                    <td class="text-center">{{rec['result']}}</td>
                    <td class="text-center">{{rec['bet_status']}}</td>
                    <td class="text-center"><button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                            data-bs-target="#place_bet_modal" data-bs-gameId="{{rec['game_id']}}"
                            data-bs-betDatetime="{{rec['bet_datetime']}}" data-bs-betLocation="{{rec['bet_location']}}"
                            data-bs-betLine="{{rec['bet_line']}}" data-bs-betAmount="{{rec['bet_amount']}}"
                            data-bs-betDirection="{{rec['bet_direction']}}" data-bs-betPrice="{{rec['bet_price']}}"
                            data-bs-betStatus="{{rec['bet_status']}}" data-bs-betProfitLoss="{{rec['bet_profit_loss']}}"
                            data-bs-spread="{{rec['spread']}}" data-bs-pick="{{rec['pick']}}">
                            Details
                        </button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- PLACE BET FORM/MODAL -->

    <div class="modal fade" id="place_bet_modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-title-js">Betting Details for GAMEID</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <h5>Current Bet Details</h5>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Datetime</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Amount</th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="bet-datetime-js">Datetime</td>
                                    <td id="bet-status-js">Status</td>
                                    <td id="bet-amount-js">Amount</td>

                                </tr>
                            </tbody>
                            <thead>
                                <tr>
                                    <th scope="col">Line</th>
                                    <th scope="col">Direction</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Location</th>
                                    <th scope="col">Profit/Loss</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="bet-line-js">Line</td>
                                    <td id="bet-direction-js">Direction</td>
                                    <td id="bet-price-js">Price</td>
                                    <td id="bet-location-js">Location</td>
                                    <td id="bet-profitloss-js">Profit/Loss</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="container-fluid">
                        <h5>New Bet Details</h5>
                        <form class="needs-validation" method="POST" novalidate>
                            <!-- Hidden field for game ID only - balance fetched server-side -->
                            <input type="hidden" id="form-gameID-js" name="bet_game_id" required>

                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="form-bet-status" class="form-label">Status</label>
                                    <select class="form-select" id="form-bet-status" name="bet_status" required>
                                        <option value="Active" selected>Active</option>
                                        <option value="Win">Win</option>
                                        <option value="Loss">Loss</option>
                                        <option value="Push">Push</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label for="form-bet-amount" class="form-label">Amount</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="form-bet-amount" name="bet_amount"
                                            step="0.01" min="0" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="form-bet-line" class="form-label">Line</label>
                                    <input type="number" class="form-control" id="form-bet-line" name="bet_line"
                                        step="0.5" required>
                                </div>
                                <div class="col-6">
                                    <label for="form-bet-direction" class="form-label">Direction</label>
                                    <select class="form-select" id="form-bet-direction" name="bet_direction" required>
                                        <option value="Home">Home</option>
                                        <option value="Away">Away</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="form-bet-price" class="form-label">Price</label>
                                    <input type="number" class="form-control" id="form-bet-price" name="bet_price"
                                        value="-110" required>
                                </div>
                                <div class="col-6">
                                    <label for="form-bet-location" class="form-label">Location</label>
                                    <select class="form-select" id="form-bet-location" name="bet_location" required>
                                        <option value="DraftKings" selected>DraftKings</option>
                                        <option value="FanDuel">FanDuel</option>
                                        <option value="MGM">MGM</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="form-bet-profitloss" class="form-label">Profit/Loss (0 for active bets)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="form-bet-profitloss" name="bet_profitloss"
                                        step="0.01" value="0" required>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--FOOTER-->

    <div class="container">
        <footer class="d-flex flex-wrap justify-content-center align-items-center py-3 my-4 border-top">
            <a href="/" class="d-flex align-items-center text-muted text-decoration-none">
                <img src="static/img/basketball.png" alt="Basketball Home" width="40" height="40">
            </a>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <script src="static/js/modal_form.js"></script>

    <script>
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
    </script>

</body>

</html>